<div id="container-instructions">
  <h1>Instructions</h1>
  <hr>
  <div class="instructions well">
    <p>
    As the experiment proceeds, the elephant will tell his story one sentence
    at a time. Click the elephant below to see a few sentences in a row.
    </p>
    <div style="overflow: hidden">
      <div class="elephant">
        <svg width=160 height=160>
          <image xlink:href="static/images/elephant.svg"
            width=120 height=120 y=40 />
        </svg>
      </div>
      <div class="cow">
        <svg width="160" height="160">
          <image xlink:href="static/images/cow.svg"
            width="160" height="120" y=40 />
        </svg>
      </div>
      <div class="stim inst-stim hidden">
        <div> </div>
      </div>
    </div>
  </div>
	<hr>
  <div class="instructionsnav">
    <div class="row">
      <div class="col-xs-2">
        <button type="button" id="next" value="next"
          class="btn btn-primary btn-lg previous">
          <span class="glyphicon glyphicon-arrow-left"></span> Previous
        </button>
      </div>
        <div class="col-xs-8">
        </div>
      <div class="col-xs-2">
        <button type="button"
          id="next"
          value="next"
          class="btn btn-primary btn-lg continue pull-right">
          Next <span class="glyphicon glyphicon-arrow-right"></span>
        </button>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    var demo_syl_code = ["wao", "yai", "piu", "shin", "bam", "fei", "ti", "ra", "ki"];
    var demodrawsyl = function(bubble, syl) {
      var s = demo_syl_code[syl] || " ";
      bubble.select("div")
            .append("p")
            .attr("class", "white")
            .text(s);
    };
    var demoshowsyl = function(bubble) {
      bubble.select(".white")
            .classed("white", false)
            .style("color", "#606388");
    };
    var demoshowbubble = function(bubble) {
      bubble.classed("hidden", false);
    };
    var demohidebubble = function(bubble) {
      bubble.classed("hidden", true);
      bubble.selectAll("p").remove();
    };
    var demofreebie = function(sequence, stim_array) {
      var fix = setInterval(function() {
        if (_.isEmpty(sequence)) {
          clearInterval(fix);
          demohidebubble(sbubble);
          setTimeout(function() { dodemo(stim_array); }, 500)
        } else {
          var syl = sequence.shift();
          demoshowsyl(sbubble);
        }
      }, 500);
      return fix;
    };
    var dodemo = function(stim_array) {
      if (stim_array.length > 0) {
        var sequence = stim_array.shift();
        _.each(sequence, _.partial(demodrawsyl, sbubble));
        demoshowbubble(sbubble);
        setTimeout(function() {
          demofreebie(sequence, stim_array);
        }, 500);
      }
    };
    var el = d3.select(".elephant");
    var sbubble = d3.select(".stim");
    el.on("click", function() {
        dodemo([[0,1,2,3,4], [1,3,0]]);
    });
  </script>
</div>
